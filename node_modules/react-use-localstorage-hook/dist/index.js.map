{"version":3,"file":"index.js","sources":["../src/hooks/localStorage.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\n\nlet subs = {};\nlet initialValues = {};\n\nfunction subToKey(key, handler, initialValue) {\n  if (!Object.prototype.hasOwnProperty.call(subs, key)) {\n    subs[key] = [];\n  }\n  if (\n    initialValue !== undefined &&\n    !Object.prototype.hasOwnProperty.call(initialValues, key)\n  ) {\n    initialValues[key] = initialValue;\n  }\n  subs[key].push(handler);\n}\n\nfunction unsubToKey(key, handler, initialValue) {\n  if (!Object.prototype.hasOwnProperty.call(subs, key)) {\n    subs[key] = [];\n  }\n\n  subs[key] = subs[key].filter(h => handler !== h);\n\n  if (initialValue !== undefined && !subs[key].length) {\n    Reflect.deleteProperty(initialValues, key);\n  }\n}\n\nfunction setKeyValue(key, value) {\n  if (!Object.prototype.hasOwnProperty.call(subs, key)) {\n    return;\n  }\n\n  subs[key].forEach(f => f(value));\n}\n\nfunction prepareReadValue(value, key) {\n  try {\n    if (\n      key !== undefined &&\n      Object.prototype.hasOwnProperty.call(initialValues, key)\n    ) {\n      const initialValue = initialValues[key];\n      if (!(initialValue instanceof Object)) {\n        return value;\n      }\n    }\n    return JSON.parse(value);\n  } catch (error) {\n    return value;\n  }\n}\n\nconst useLocalStorage = (key, initialState) => {\n  const [state, setState] = useState(() => {\n    try {\n      const item = localStorage.getItem(key);\n      return item !== null ? prepareReadValue(item, key) : initialState;\n    } catch (error) {\n      return initialState;\n    }\n  });\n\n  const wathcer = value => {\n    setState(value);\n  };\n\n  useEffect(() => {\n    subToKey(key, wathcer, initialState);\n    return () => {\n      unsubToKey(key, wathcer, initialState);\n    };\n  }, []);\n\n  const updateStorage = value => {\n    setKeyValue(key, value);\n    localStorage.setItem(\n      key,\n      value instanceof Object ? JSON.stringify(value) : value\n    );\n  };\n\n  return [state, updateStorage];\n};\n\nwindow.addEventListener(\"storage\", event => {\n  const { key, newValue } = event;\n  if (!Object.prototype.hasOwnProperty.call(subs, key)) {\n    return;\n  }\n  setKeyValue(key, prepareReadValue(newValue, key));\n});\n\nexport default useLocalStorage;\n"],"names":["useState","useEffect"],"mappings":"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"}